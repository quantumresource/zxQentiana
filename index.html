<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <script type="text/javascript">
        window.languagePluginUrl = 'githubiofiles/'; // set the pyodide support files (packages.json, pyodide.asm.data etc) url
    </script>
    <script src="githubiofiles/pyodide.js"></script>

    <script src="js/d3.v4.min.js"></script>
    <script src="js/pyzx.js"></script>

    <script>
      pyZXJS = new pyZXJavaScript();
    </script>

</head>
<body>
    <div style="width: 90%; float:left; background:lightskyblue; margin:10px" id="fig_circuit">
        zxQentiana <a target="_blank" href="https://github.com/quantumresource/zxQentiana">Github repository</a>
    </div>
  <div style="width: 40%; float:left; height:400px; background:lightcoral; margin:10px">
    <textarea rows="4" id="txt_script" style="width:90%; height:90%">
import json
from fractions import Fraction

import pyzx as zx
import cube_to_physical as qre

# https://github.com/iodide-project/pyodide/blob/master/docs/type_conversions.md#using-javascript-objects-from-python
from js import document
from js import pyZXJS

# get DOM elements
cons = document.getElementById("txt_console")
figcircuit = document.getElementById("fig_circuit")

def phase_to_s(a):
    if not a: return ''
    if not isinstance(a, Fraction):
        a = Fraction(a)
    ns = '' if a.numerator == 1 else str(a.numerator)
    ds = '' if a.denominator == 1 else '/' + str(a.denominator)

    # unicode 0x03c0 = pi
    return ns + '\u03c0' + ds

def draw(g, where, scale=None):
    if not hasattr(g, 'vertices'):
        g = g.to_graph()

    if scale == None:
      scale = 800 / (g.depth() + 2)
      if scale > 50: scale = 50
      if scale < 20: scale = 20

    node_size = 0.2 * scale
    if node_size < 2: node_size = 2

    node_size = 5

    w = (g.depth() + 2) * scale
    h = (g.qubit_count() + 3) * scale

    nodes = [{'name': str(v),
              'x': (g.row(v) + 1) * scale,
              'y': (g.qubit(v) + 2) * scale,
              't': g.type(v),
              'phase': phase_to_s(g.phase(v)) }
             for v in g.vertices()]
    links = [{'source': str(g.edge_s(e)),
              'target': str(g.edge_t(e)),
              't': g.edge_type(e) } for e in g.edges()]
    
    graphj = json.dumps({'nodes': nodes, 'links': links})

    pyZXJS.showGraph('#graph-output-1', graphj, w, h, node_size)

#
# PyZX part
#
qubit_amount = 10
gate_count = 80

#Generate random circuit of Clifford gates
circuit = zx.generate.cliffordT(qubit_amount, gate_count)

#Use one of the built-in rewriting strategies to simplify the circuit
zx.simplify.full_reduce(circuit)
draw(circuit, figcircuit)

# Some information from the circuit
t_count = zx.tcount(circuit)
max_log_qubits = circuit.qubit_count()
cons.innerText += "T gates from pyZX " + str(t_count) + " " + str(max_log_qubits)
# estimate the resources
qentiana = qre.Qentiana(t_count, max_log_qubits)
res_values = qentiana.compute_physical_resources()
estimation = "\nResource prediction (phys. qubits, time): " + str(res_values)

#print estimation
cons.innerText += estimation

    </textarea>
    <br>
    <input type="button" value="zxQentiana in Action" id="btnrun" onclick="runscript()">
  </div>

  <div style="width: 40%; float:left; height:400px; background:rgb(203, 219, 182); margin:10px" id="txt_console">
  </div>

  <div style="width: 90%; float:left; height:400px; background:lightskyblue; margin:10px" id="fig_circuit">
    <p>
        Click and drag the nodes.
    </p>
    <br>
    <div id="graph-output-1" style="overflow:auto"></div>
  </div>

  <script type="text/javascript">
    languagePluginLoader.then(function () {
            pyodide.loadPackage(['pyzx', 'cube_to_physical']);
        });

    function py (code)
    {
      return pyodide.runPython(code);
    }

    function runscript()
    {
      //read script
      scriptLines = document.getElementById("txt_script").value;
      //run script
      py(scriptLines);
    }
  </script>
</body>
